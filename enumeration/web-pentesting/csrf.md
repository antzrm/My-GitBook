---
description: Cross Site Request Forgery
---

# CSRF

## Overview

{% embed url="https://pentestbook.six2dez.com/enumeration/web/csrf" %}

{% hint style="info" %}
Also works with POST method. In that case we need to host a .html file with the POST request for example and trigger that file.
{% endhint %}

```
Change password --> see if the POST method can be changed to GET successfully

If there is a contact form or another way the user interacts with our data -->
send that link with GET method to change that user's pass -->
check if the user clicks it by send it another link that is hosted by us
```

CSRF is a type of security vulnerability where an attacker **tricks a user's web browser into performing an unwanted action on a trusted site where the user is authenticated**. This is achieved by exploiting the fact that the browser includes any relevant cookies (credentials) automatically, allowing the attacker to forge and submit unauthorised requests on behalf of the user (through the browser).

For instance, let's say a user clicks a link to a website created by a hacker, on the website would be an html tag such as `<img src="https://vulnerable-website.com/email/change?email=pwned@evil-user.net">`  which would change the account email on the vulnerable website to "pwned@evil-user.net".  CSRF works because it's the victim making the request not the site, so all the site sees is a normal user making a normal request.

This opens the door, to the user's account being fully compromised through the use of a password reset for example. The severity of this cannot be overstated, as it allows an attacker to potentially gain personal information about a user, such as credit card details in an extreme case.

## Types of CSRF

**Traditional CSRF:** The victim, being authenticated, is tricked into submitting a form without realising the associated data like cookies, URL parameters, etc.

**XMLHttpRequest CSRF:** An asynchronous CSRF exploitation occurs when operations are initiated without a complete page request-response cycle. This is typical of contemporary online apps that leverage asynchronous server communication (via **XMLHttpRequest** or the **Fetch** API) and JavaScript to produce more dynamic user interfaces.

**Flash-based CSRF:** conducting a CSRF attack by taking advantage of flaws in Adobe Flash Player components. Uncommon, Adobe Flash is not been used years ago and support ceased end of 2020. A **malicious Flash file (.swf)** posted on the attacker's website would typically send unauthorised requests to other websites to carry out Flash-based CSRF attacks.

## Anti-CSRF Token Bypass

In case that **token is weak and not well encrypted**, we can decode its value and use it within a hidden form to deceive the user and make the server think it is a legit request.

**SameSite Lax** can be exploitable if the origin comes from the same domain or top-level. Example: link with logout action.

hidden image tokens, SameSite attributes, double-submit cookies, and refining the referrer policy used by hackers to exploit web application security

## Manual exploitation

```
INTERCEPT CHANGE PASSWORD, SEE IF GET METHOD IS POSSIBLE, CSRF PoC (BURP)

If an exploit is CSRF or this vulnerability is present, we should find
a HTML form, we copy it to a .html file, host/serve it and 
click on it (action link will lead to CSRF)
```

Let's take an example application&#x20;

![](<../../.gitbook/assets/image (65).png>)

It seems simple enough, As user bob, I can send funds to either Bob or Alice with any of the available balance in my account. Let's take a closer look at the request in Burp.

![](<../../.gitbook/assets/image (30).png>)

This is looking good, parameters we can customize and a session cookie that is automatically set. Everything seems vulnerable to CSRF. Let's try and make a vulnerable site. Putting `<img src="http://localhost:3000/transfer?to=alice&amount=100">` into an html file and using SimpleHTTPServer to host it should change's Alice's balance by 100, Let's see if it does!

![](<../../.gitbook/assets/image (118).png>)

## Automatic exploitation

```
pip3 install xsrfprobe
xsrfprobe -u <url>/<endpoint>
```
